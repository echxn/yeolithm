/*
 * SILVA THEME by https://yeoli-thm.tumblr.com/
 * Copyright (c) 2023 yeoli-thm
 */

!function(t){t.fn.exists=function(){return this.length>0};var e=window.getComputedStyle(document.body),n=parseInt(e.getPropertyValue("--current-page-number"),10),i={background:"rgba(0,0,0,0)",color:e.getPropertyValue("--post-audio-text-color")},s=t(window),a=t("body");t("body.index-page").exists();var o=t("body.load-ifnt").exists(),r=t("#backtotop"),l=a.find(".tmblrctrls-item"),d=l.find("a#tmblrctrls-button"),c=l.find("#tmblrctrls-box"),p=a.find("a#search-button"),u=a.find("#searchbox"),f=u.find("a#search-close-button"),h=u.find(".searchquery"),v=null;function $(){t("[title]").tooltipster({anchor:"top-left",offset:[14,-18],plugins:["follower"],animationDuration:300,delay:100,maxWidth:160,updateAnimation:null,trigger:"custom",triggerOpen:{click:!0,mouseenter:!0,tap:!1,touchstart:!1},triggerClose:{click:!1,mouseleave:!0,originClick:!1,scroll:!0,tap:!0,touchleave:!0}})}function m(){$(),t.tooltipster.group("tooltip"),a.on("mouseover",".blog-description, .notes",$)}function g(){t(".post-item:not(.appended)").each(function(){var e,n=t(this),s=t(this).attr("id");if("normal"==n.attr("data-post-category")){var a=n.attr("data-month");if(a!=v)n.wrap('<div class="month-group"></div>'),n.parent(".month-group").prepend('<div class="leftbar month-label"><h1>'+a+"</h1></div>"),v=a;else if(a==v){var o=n.prevAll(".month-group").first();n.appendTo(o)}}if(n.find(".timeago").timeAgo({time:"letter",spaces:!0}),n.hasClass("has-notes")){var r=n.find("#notes-button-"+s),l=n.find("#notes-wrapper-"+s);r.click(function(e){e.preventDefault(),r.hasClass("open")?(l.slideUp(300),r.tooltipster("content","View notes").removeClass("open")):(l.slideDown(300,function(){l.find(".notes_holder.unprocessed").exists()&&t.ajax({url:r.attr("data-notes-url"),success:function(t){l.find(".notes_loader").hide(),l.find(".notes_holder").html(t).slideDown().removeClass("unprocessed")}})}),r.tooltipster("content","Hide notes").addClass("open"))})}return n.photoset(),n.video(),n.npfLink(),n.npfQuote(),n.npfChat(),(e=n).find("iframe.tumblr_audio_player").load(function(){t(this).contents().find(".audio-player").css(i).find(".progress").css({background:"rgba(0,0,0,0)"})}),e.find(".audio-caption:not(.processed)").each(function(){var e=t(this),n=e.next("audio").children("source").attr("src"),i="",s="",a=e.find(".tmblr-audio-meta.title").exists()?'<h5 class="trackname">'+e.find(".tmblr-audio-meta.title").text()+"</h5>":"",o=e.find(".tmblr-audio-meta.artist").exists()?'<p class="artist">'+e.find(".tmblr-audio-meta.artist").text()+"</p>":"";e.find("img.album-cover").exists()&&(s='<div class="album_art"><img src="'+(i=e.find("img.album-cover").attr("src"))+'" alt=""/></div>'),e.html('<div class="audio_bg" style="background-image:url('+i+')"></div><div class="audio_inner"><div class="player_container"><div class="svgaudiobutton"><svg class="playbutton"><use xlink:href="#playButton"/></svg><svg class="pausebutton"><use xlink:href="#pauseButton"/></svg></div></div><div class="audio_details">'+a+o+"</div>"+s+"</div>");var r=e.find(".svgaudiobutton"),l=new Audio(n);l.addEventListener("canplay",function(){r.addClass("playable")}),l.addEventListener("timeupdate",function(){var t=l.duration;l.currentTime==t&&r.removeClass("playing").addClass("paused")}),r.click(function(){!1==l.paused?(r.removeClass("playing").addClass("paused"),l.pause()):(r.removeClass("paused").addClass("playing"),l.play())}),e.addClass("processed")}),n.addClass("appended"),this})}function b(){var e=s.height(),n=s.scrollTop()+e+80;t(".not-visible").each(function(){var e=t(this);return t("#"+e.parents('[id$="-tab"]').data("tab-label")+"-check").is(":checked")&&e.offset().top<n&&e.addClass("is-visible").removeClass("not-visible"),this})}if(t.fn.photoset=function(){return this.find(".photo-slideshow:not(.processed)").pxuPhotoset({lightbox:!0,highRes:!0,rounded:!1,exif:!1,captions:!1,gutter:"4px",photoset:".photo-slideshow",photoWrap:".photo-data",photo:".pxu-photo"})},t.fn.video=function(){return this.find(".tmblr-embed:not(.processed)").each(function(){var e=t(this);if(e.find(".instagram-media").exists())e.addClass("processed");else{var n=e.find("iframe").width(),i=e.find("iframe").height();e.find("iframe").wrap('<div class="vid-resize"/>'),e.find(".vid-resize").css({"padding-Bottom":Math.floor(i/n*100)+"%"}),e.addClass("processed")}})},t.fn.npfLink=function(){return this.find(".npf-link-block").each(function(){var e=t(this),n=t(this).find("a").attr("href"),i=t(this).find(".title").exists()?'<h2 class="post_link_heading">'+t(this).find(".title").text()+"</h2>":"";e.replaceWith('<a class="post_link" href="'+n+'" target="_blank">'+i+'<i data-feather="chevron-right"></i></div>')})},t.fn.npfQuote=function(){return this.find(".npf_quote").each(function(){var e=t(this),n=e.html();e.replaceWith('<div class="post_quote"><span>'+n+"</span></div>")})},t.fn.npfChat=function(){return this.find(".npf_chat").each(function(){var e=t(this);e.prepend("<br>").append("<br>"),e.find("br").each(function(e){t(this).attr("class",e)});let n=e.children("br").length;for(let i=1;i<n;i++){var s=i-1,a=i,o=e.contents(),r=o.index(e.find('br[class="'+s+'"]')),l=o.index(e.find('br[class="'+a+'"]'));o.slice(r,l).wrapAll("<li>"),i==n-1&&(e.find("br").remove(),e.html('<ul class="post_chat resetlist">'+e.html()+"</ul>").contents().unwrap())}})},m(),1!==t("#panelbar .panelbar").children().length&&a.addClass("has-panelbar"),t("#container").each(function(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","symbol"),i=document.createElementNS("http://www.w3.org/2000/svg","symbol"),s=document.createElementNS("http://www.w3.org/2000/svg","path"),a=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttributeNS(null,"d","M3.947,20.834V3.166l16.105,8.833L3.947,20.834L3.947,20.834z"),n.setAttributeNS(null,"id","playButton"),n.setAttributeNS(null,"viewbox","0 0 24 24"),n.appendChild(s),a.setAttributeNS(null,"d","M3.897,3.6h6.569v16.8H3.897V3.6z M13.534,3.6h6.568v16.8h-6.568V3.6z"),i.setAttributeNS(null,"id","pauseButton"),i.setAttributeNS(null,"viewbox","0 0 24 24"),i.appendChild(a),e.setAttributeNS(null,"width","0"),e.setAttributeNS(null,"height","0"),e.appendChild(n),e.appendChild(i),t(this).append(e)}),o){var x=t("#main"),w=t("#page_number").find(".currentpage"),C=0;C=n<=9?"0"+n.toString():n.toString(),w.text(C),g(),b(),x.infiniteScroll({path:"a#next",append:"#main .post-item",status:".page-load-status",prefill:!0,scrollThreshold:600}),x.on("append.infiniteScroll",function(e,i,s,a){n+=1,C=n<=9?"0"+n.toString():n.toString(),w.text(C),g();var o=t(a).map(function(){return t(this).attr("id")}).get();Tumblr.LikeButton.get_status_by_post_ids(o),m()})}else{var y=t("#pagination"),k=n+1,S=n-1;k=k<=9?"0"+k.toString():k.toString(),S=S<=9?"0"+S.toString():S.toString(),y.find(".nextnum").text(k),y.find(".prevnum").text(S),g(),b()}t('input[name="toggletab"]').change(function(){o&&(t("input#blog-check").is(":checked")?x.infiniteScroll("option",{scrollThreshold:600,loadOnScroll:!0}):x.infiniteScroll("option",{scrollThreshold:!1,loadOnScroll:!1})),t("body,html").animate({scrollTop:0},0),b()});var N=_.debounce(function(){b()},300);s.resize(N);var A=_.throttle(function(){var e=t(this).scrollTop();b(),e>200&&"none"==r.css("display")?r.fadeIn(200):e<=200&&"none"!==r.css("display")&&r.fadeOut(200)},100);s.scroll(A),r.click(function(e){return e.preventDefault(),t("body,html").animate({scrollTop:0},600),!1}),d.click(function(t){t.preventDefault(),c.hasClass("active")?(c.removeClass("active"),d.tooltipster("content","Tumblr controls").find("span").attr("class","fx fx-settings")):(c.addClass("active"),d.tooltipster("content","Close").find("span").attr("class","fx fx-x"))}),p.click(function(t){t.preventDefault(),u.fadeIn(300).addClass("active"),h.focus()}),f.click(function(t){t.preventDefault(),u.fadeOut(0).removeClass("active")}),s.load(function(){var e=0,n=setInterval(function(){e<10&&(t(".iframe-controls--desktop").exists()||t(".iframe-controls--phone-mobile").exists())?(clearInterval(n),l.removeClass("hidden"),t(".tmblr-iframe--loaded").clone().appendTo(c)):10===e&&(clearInterval(n),l.remove()),e++},1e3)})}(jQuery);
