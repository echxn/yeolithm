/*
 * Moonrise Theme by https://yeoli-thm.tumblr.com/
 * Copyright (c) 2021 yeoli-thm
 */

!function(t){function e(){var e=t(this),i=e.parent(".post");i.attr("id");e.is(":checked")?(u.addClass("ga"),i.find(".notes-container:not(processed)").length>0&&t.ajax({url:i.attr("data-notes-url"),success:function(t){i.find(".notes-loader").hide(),i.find(".notes-container").html(t).slideDown().addClass("processed")}}),u.hasClass("mobile")&&t(".gridlayout").css({"max-width":a.data("masonry").size.width})):(u.removeClass("ga"),t("body").hasClass("mobile")&&t(".gridlayout").css({"max-width":"none"}))}function i(){p[0].scrollWidth>p.width()?p.kinetic("attach"):p.kinetic("detach")}function o(){t("[title]").tooltipster({anchor:"top-left",offset:[14,-18],plugins:["follower"],animationDuration:300,delay:200,maxWidth:160,updateAnimation:null,trigger:"custom",triggerOpen:{click:!0,mouseenter:!0,tap:!1,touchstart:!1},triggerClose:{click:!1,mouseleave:!0,originClick:!1,scroll:!0,tap:!0,touchleave:!0}})}function s(){t(".iframe-controls--desktop").exists()||t(".iframe-controls--phone-mobile").exists()?(t(".tmblr-controls-wrapper").removeClass("hidden"),t(".tmblr-iframe--loaded").clone().appendTo(".tmblr-controls-content"),t(".tmblr-controls-button").click(function(){t("#updates-button").exists()&&t("#updates-button").prop("checked",!1)})):setTimeout(s,500)}t.fn.exists=function(){return this.length>0},t.fn.npfFix=function(e){return this.each(function(){var e=t(this);e.find("figure").each(function(){null==t(this).attr("class")&&null!=t(this).attr("data-orig-width")||null!=t(this).attr("data-tumblr-attribution")?t(this).wrap('<div class="npf-wrap-single"/>'):"tmblr-full"!=t(this).attr("class")||t(this).parents(".npf_row").exists()||null!=t(this).attr("data-tumblr-attribution")||t(this).addClass("npf-item")}),e.find(".npf_row").each(function(){t(this).addClass("npf-item")}),e.find(".npf-item").not(".npf-item + .npf-item").each(function(){t(this).nextUntil(":not(.npf-item)").addBack().wrapAll('<div class="npf-wrap-all"/>')})})},t.fn.photoset=function(e){return this.each(function(){var i=t(this),o=i.find(".photo-slideshow:not(.processed)");o.exists()&&i.imagesLoaded().always(function(){o.pxuPhotoset({lightbox:!0,highRes:!0,rounded:!1,exif:!1,captions:!1,gutter:"4px",photoset:".photo-slideshow",photoWrap:".photo-data",photo:".pxu-photo"}),i.parents("#main").exists()&&e.masonry("layout")})})},t.fn.video=function(e){return this.each(function(){var i=t(this),o=i.find(".tmblr-embed:not(.processed)");if(o.exists())if(o.find(".instagram-media").exists()){if(o.addClass("processed"),i.parents("#main").exists())var s=0,a=setInterval(function(){s<5?(++s,e.masonry("layout")):clearInterval(a)},1e3)}else{var n=o.find("iframe").width(),r=o.find("iframe").height(),l=Math.floor(r/n*100)+"%";o.find("iframe").wrap('<div class="vid-resize"/>'),o.find(".vid-resize").css({"padding-Bottom":l}),o.addClass("processed")}})},t.fn.gridload=function(e){return this.each(function(){var e=t(this);if(e.parents(".gridlayout").exists()){var i=e.find(".grid-image:not(.loaded)"),o=e.find(".grid-image:not(.loaded) img");i.exists()&&o.imagesLoaded().always(function(){var t=o.width(),e=o.height();if(t>e){var s=Math.ceil(t/e*100)+"%";i.css("width",s).addClass("resized loaded")}else i.addClass("loaded")})}})},t(window).load(function(){t(".tmblr-iframe").exists()&&s()});var a,n,r,l=t(".homepage").exists(),d=t(".gridlayout").exists(),c=t(".defaultpgn").exists(),u=t("body"),p=t("#navigation"),f=p.offset().top,h=window.matchMedia("(min-width: 768px)").matches,m=!!t(".ifntscroll").exists()&&600;h?u.addClass("desktop"):u.addClass("mobile"),o(),function(){if(l&&d)if(h)var i={gutter:".grid-gutter",columnWidth:".grid-sizer",itemSelector:".grid-post",percentPosition:!1,fitWidth:!0};else i={gutter:".grid-gutter",columnWidth:".grid-sizer",itemSelector:".grid-post",percentPosition:!0,fitWidth:!1};else i={gutter:".post-gutter",columnWidth:".post-sizer",itemSelector:"#main .default-post",percentPosition:!0,fitWidth:!1};a=t("#main").masonry(i).masonry(),t(".post").gridload(a).npfFix(a).photoset(a).video(a),a.imagesLoaded().progress(function(){a.masonry("layout")}),t(".npf_row").each(function(){t(this).addClass("clickable")}),c||(n=a.data("masonry"),a.infiniteScroll({path:"a#next",append:"#main .post",status:".page-load-status",button:".manual-load-button",outlayer:n,prefill:!0,scrollThreshold:m}),a.on("append.infiniteScroll",function(e,i,s,n){var r=t(n).map(function(){return t(this).attr("id")}).get();Tumblr.LikeButton.get_status_by_post_ids(r),t(n).gridload(a).npfFix(a).photoset(a).video(a),t(".npf_row:not(.clickable):not(.disabled)").each(function(){t(this).addClass("disabled")}),a.masonry("layout"),o(),t.tooltipster.group("tooltip")})),u.on("change",'[id^="input-"]',e),function(e){p.find('a[data-page$="-page"]').click(function(i){i.preventDefault();var o=t(this).attr("data-page");$selected=t(".selected"),t(window).scrollTop(0),u.hasClass(o)?(u.removeClass(o),$selected.exists()&&$selected.addClass("current-page"),c||e.infiniteScroll("option",{loadOnScroll:!0,history:"replace"})):(u.removeClass("likes-page following-page").addClass(o),$selected.exists()&&$selected.removeClass("current-page"),c||e.infiniteScroll("option",{loadOnScroll:!1,history:!1}))})}(a)}(),l?p.find(".posts-link").addClass("current-page selected"):p.find("a:not(.posts-link)").each(function(){var e=t(this),i=e.attr("href",encodeURI(t(this).attr("href"))).attr("href");0===document.location.pathname.indexOf(i)&&e.addClass("current-page selected")}),t(window).scroll(function(){t(window).scrollTop()-60>=f?(p.addClass("fixed"),t("#navigation-shadow").show(0),u.hasClass("desktop")&&t("#to-top").fadeIn(400)):(p.removeClass("fixed"),t("#navigation-shadow").hide(0),t("#to-top").fadeOut(400))}),p.kinetic({cursor:"default",filterTarget:function(t,e){if(!/down|start/.test(e.type))return!/area|a|input/i.test(t.tagName)}}),i(),t(".topbar-buttons label").click(function(){t(this).tooltipster("close")}),t("#to-top").click(function(){return t("body,html").animate({scrollTop:0},600),!1}),u.on("mouseover","#header, .notes-wrapper",o),t(".topbar-buttons label").click(function(){t(this).tooltipster("close")}),t(window).resize(function(){clearTimeout(r),r=setTimeout(function(){!function(t,e){(h=window.matchMedia("(min-width: 768px)").matches)&&u.hasClass("mobile")?(u.removeClass("mobile").addClass("desktop"),d&&(t=t.masonry("destroy").data("masonry",null).masonry({gutter:".grid-gutter",columnWidth:".grid-sizer",itemSelector:".grid-post",percentPosition:!1,fitWidth:!0}).masonry(),c||(e=t.data("masonry"),t.infiniteScroll("option",{outlayer:e})))):!h&&u.hasClass("desktop")&&(u.removeClass("desktop").addClass("mobile"),d&&(t=t.masonry("destroy").data("masonry",null).masonry({gutter:".grid-gutter",columnWidth:".grid-sizer",itemSelector:".grid-post",percentPosition:!0,fitWidth:!1}).masonry(),c||(e=t.data("masonry"),t.infiniteScroll("option",{outlayer:e}))))}(a,n),i()},500)})}(jQuery);
