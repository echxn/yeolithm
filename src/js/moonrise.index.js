/*
 * Moonrise Theme by https://yeoli-thm.tumblr.com/
 * Copyright (c) 2021 yeoli-thm
 */

!function(t){function i(){var i=t(this),e=i.parent(".post");e.attr("id");i.is(":checked")?(p.addClass("ga"),e.find(".notes-container:not(processed)").length>0&&t.ajax({url:e.attr("data-notes-url"),success:function(t){e.find(".notes-loader").hide(),e.find(".notes-container").html(t).slideDown().addClass("processed")}}),p.hasClass("mobile")&&t(".gridlayout").css({"max-width":a.data("masonry").size.width})):(p.removeClass("ga"),t("body").hasClass("mobile")&&t(".gridlayout").css({"max-width":"none"}))}function e(){f[0].scrollWidth>f.width()?f.kinetic("attach"):f.kinetic("detach")}function o(){t("[title]").tooltipster({anchor:"top-left",offset:[14,-18],plugins:["follower"],animationDuration:300,delay:200,maxWidth:160,updateAnimation:null,trigger:"custom",triggerOpen:{click:!0,mouseenter:!0,tap:!1,touchstart:!1},triggerClose:{click:!1,mouseleave:!0,originClick:!1,scroll:!0,tap:!0,touchleave:!0}})}function s(){t(".iframe-controls--desktop").exists()||t(".iframe-controls--phone-mobile").exists()?(t(".tmblr-controls-wrapper").removeClass("hidden"),t(".tmblr-iframe--loaded").clone().appendTo(".tmblr-controls-content"),t(".tmblr-controls-button").click(function(){t("#updates-button").exists()&&t("#updates-button").prop("checked",!1)})):setTimeout(s,500)}t.fn.exists=function(){return this.length>0},t.fn.npfFix=function(i){return this.each(function(){var i=t(this);i.find("figure").each(function(){null==t(this).attr("class")&&null!=t(this).attr("data-orig-width")||null!=t(this).attr("data-tumblr-attribution")?t(this).wrap('<div class="npf-wrap-single"/>'):"tmblr-full"!=t(this).attr("class")||t(this).parents(".npf_row").exists()||null!=t(this).attr("data-tumblr-attribution")||t(this).addClass("npf-item")}),i.find(".npf_row").each(function(){t(this).addClass("npf-item");var i=t(this).first(".npf_col").find("a.post_media_photo_anchor").attr("data-big-photo-height"),e=t(this).first(".npf_col").find("a.post_media_photo_anchor").attr("data-big-photo-width"),o=Math.floor(i/e*100);t(this).find(".tmblr-full").css("padding-bottom",o+"%")}),i.find(".npf-item").not(".npf-item + .npf-item").each(function(){t(this).nextUntil(":not(.npf-item)").addBack().wrapAll('<div class="npf-wrap-all"/>')})})},t.fn.photoset=function(i){return this.each(function(){var e=t(this),o=e.find(".photo-slideshow:not(.processed)");o.exists()&&e.imagesLoaded().always(function(){o.pxuPhotoset({lightbox:!0,highRes:!0,rounded:!1,exif:!1,captions:!1,gutter:"4px",photoset:".photo-slideshow",photoWrap:".photo-data",photo:".pxu-photo"}),e.parents("#main").exists()&&i.masonry("layout")})})},t.fn.video=function(i){return this.each(function(){var e=t(this),o=e.find(".tmblr-embed:not(.processed)");if(o.exists())if(o.find(".instagram-media").exists()){if(o.addClass("processed"),e.parents("#main").exists())var s=0,a=setInterval(function(){s<5?(++s,i.masonry("layout")):clearInterval(a)},1e3)}else{var n=o.find("iframe").width(),r=o.find("iframe").height(),d=Math.floor(r/n*100)+"%";o.find("iframe").wrap('<div class="vid-resize"/>'),o.find(".vid-resize").css({"padding-Bottom":d}),o.addClass("processed")}})},t.fn.gridload=function(i){return this.each(function(){var i=t(this);if(i.parents(".gridlayout").exists()){var e=i.find(".grid-image:not(.loaded)"),o=i.find(".grid-image:not(.loaded) img");e.exists()&&o.imagesLoaded().always(function(){var t=o.width(),i=o.height();if(t>i){var s=Math.ceil(t/i*100)+"%";e.css("width",s).addClass("resized loaded")}else e.addClass("loaded")})}})},t(window).load(function(){t(".tmblr-iframe").exists()&&s()});var a,n,r,d=t(".homepage").exists(),l=t(".gridlayout").exists(),c=t(".defaultpgn").exists(),p=t("body"),f=t("#navigation"),u=f.offset().top,h=window.matchMedia("(min-width: 768px)").matches,m=!!t(".ifntscroll").exists()&&600;h?p.addClass("desktop"):p.addClass("mobile"),o(),function(){if(d&&l)if(h)var e={gutter:".grid-gutter",columnWidth:".grid-sizer",itemSelector:".grid-post",percentPosition:!1,fitWidth:!0};else e={gutter:".grid-gutter",columnWidth:".grid-sizer",itemSelector:".grid-post",percentPosition:!0,fitWidth:!1};else e={gutter:".post-gutter",columnWidth:".post-sizer",itemSelector:"#main .default-post",percentPosition:!0,fitWidth:!1};a=t("#main").masonry(e).masonry(),t(".post").gridload(a).npfFix(a).photoset(a).video(a),a.imagesLoaded().progress(function(){a.masonry("layout")}),t(".npf_row").each(function(){t(this).addClass("clickable")}),c||(n=a.data("masonry"),a.infiniteScroll({path:"a#next",append:"#main .post",status:".page-load-status",button:".manual-load-button",outlayer:n,prefill:!0,scrollThreshold:m}),a.on("append.infiniteScroll",function(i,e,s,n){var r=t(n).map(function(){return t(this).attr("id")}).get();Tumblr.LikeButton.get_status_by_post_ids(r),t(n).gridload(a).npfFix(a).photoset(a).video(a),t(".npf_row:not(.clickable):not(.disabled)").each(function(){t(this).addClass("disabled")}),a.masonry("layout"),o(),t.tooltipster.group("tooltip")})),p.on("change",'[id^="input-"]',i),function(i){f.find('a[data-page$="-page"]').click(function(e){e.preventDefault();var o=t(this).attr("data-page");$selected=t(".selected"),t(window).scrollTop(0),p.hasClass(o)?(p.removeClass(o),$selected.exists()&&$selected.addClass("current-page"),c||i.infiniteScroll("option",{loadOnScroll:!0,history:"replace"})):(p.removeClass("likes-page following-page").addClass(o),$selected.exists()&&$selected.removeClass("current-page"),c||i.infiniteScroll("option",{loadOnScroll:!1,history:!1}))})}(a)}(),d?f.find(".posts-link").addClass("current-page selected"):f.find("a:not(.posts-link)").each(function(){var i=t(this),e=i.attr("href",encodeURI(t(this).attr("href"))).attr("href");0===document.location.pathname.indexOf(e)&&i.addClass("current-page selected")}),t(window).scroll(function(){t(window).scrollTop()-60>=u?(f.addClass("fixed"),t("#navigation-shadow").show(0),p.hasClass("desktop")&&t("#to-top").fadeIn(400)):(f.removeClass("fixed"),t("#navigation-shadow").hide(0),t("#to-top").fadeOut(400))}),f.kinetic({cursor:"default",filterTarget:function(t,i){if(!/down|start/.test(i.type))return!/area|a|input/i.test(t.tagName)}}),e(),t(".topbar-buttons label").click(function(){t(this).tooltipster("close")}),t("#to-top").click(function(){return t("body,html").animate({scrollTop:0},600),!1}),p.on("mouseover","#header, .notes-wrapper",o),t(".topbar-buttons label").click(function(){t(this).tooltipster("close")}),t(window).resize(function(){clearTimeout(r),r=setTimeout(function(){!function(t,i){(h=window.matchMedia("(min-width: 768px)").matches)&&p.hasClass("mobile")?(p.removeClass("mobile").addClass("desktop"),l&&(t=t.masonry("destroy").data("masonry",null).masonry({gutter:".grid-gutter",columnWidth:".grid-sizer",itemSelector:".grid-post",percentPosition:!1,fitWidth:!0}).masonry(),c||(i=t.data("masonry"),t.infiniteScroll("option",{outlayer:i})))):!h&&p.hasClass("desktop")&&(p.removeClass("desktop").addClass("mobile"),l&&(t=t.masonry("destroy").data("masonry",null).masonry({gutter:".grid-gutter",columnWidth:".grid-sizer",itemSelector:".grid-post",percentPosition:!0,fitWidth:!1}).masonry(),c||(i=t.data("masonry"),t.infiniteScroll("option",{outlayer:i}))))}(a,n),e()},500)})}(jQuery);
