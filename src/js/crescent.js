/*
 * CRESCENT THEME by https://yeoli-thm.tumblr.com/
 * Copyright (c) 2021 yeoli-thm
 */

!function(t){t.fn.exists=function(){return this.length>0};var e=window.getComputedStyle(document.body),i=e.getPropertyValue("--photosetGutterSize"),n={background:"rgba(0,0,0,0)",color:"rgb("+e.getPropertyValue("--accentTextColor")+")"},a=e.getPropertyValue("--maxTruncatedTags"),s=e.getPropertyValue("--maxBlogFollowings"),o=t(window),l=t("body"),r=window.matchMedia("(min-width: 1248px)"),c=l.find("#container"),d=l.find("#left").find(".sidebar__inner"),h=l.find("#right").find(".sidebar__inner"),f=l.hasClass("sxc"),p=l.hasClass("sxa"),u=CSS.supports("position: sticky"),v=l.find("#featured"),g=l.find("#calendar"),m=l.find("#calendarbox"),b=l.find(".calendar_overlay"),y=l.find("#calendarsection"),k=["January","February","March","April","May","June","July","August","September","October","November","December"];const C=new Date,w=C.getFullYear(),_=C.getMonth(),D=C.getDate();var S,T,B,H=w,M=_,E=l.hasClass("sbdark")?"os-theme-thin-dark":"os-theme-thin-light",P=["","k","M","G","T","P","E"];function A(){t("[title]").tooltipster({anchor:"top-left",offset:[14,-18],plugins:["follower"],animationDuration:300,delay:100,updateAnimation:null,trigger:"custom",triggerOpen:{click:!0,mouseenter:!0,tap:!1,touchstart:!1},triggerClose:{click:!1,mouseleave:!0,originClick:!1,scroll:!0,tap:!0,touchleave:!0}})}var I=function(e,i){function n(t,e){var i=o.scrollTop(),n=t;r.matches&&n.containerHeight>n.vpHeight?n.elemHeight>n.vpHeight-80&&n.containerHeight>n.elemHeight?(e.hasClass("sticky--top")&&e.removeClass("sticky--top"),i<=n.elemBottom?e.removeClass("sticky--bottom sticky--end"):i>n.elemBottom&&i<=n.containerBottom?e.hasClass("sticky--bottom")||e.removeClass("sticky--end").addClass("sticky--bottom"):i>n.containerBottom&&(e.hasClass("sticky--end")||e.removeClass("sticky--bottom").addClass("sticky--end"))):e.hasClass("sticky--top")||e.removeClass("sticky--bottom sticky--end").addClass("sticky--top"):r.matches||e.removeClass("sticky--top sticky--bottom sticky--end")}this._varibles={vpHeight:o.height(),containerHeight:c.height(),containerBottom:c.height()+c.offset().top-o.height()+40,elemHeight:i.height(),elemBottom:i.height()+c.offset().top-o.height()},this.recalculate=function(){if(!p||!u)return!1;var a={vpHeight:o.height(),containerHeight:c.height(),containerBottom:c.height()+c.offset().top-o.height()+40,elemHeight:i.height(),elemBottom:i.height()+c.offset().top-o.height()};(function(t,e){var i=Object.getOwnPropertyNames(t),n=Object.getOwnPropertyNames(e);if(i.length!=n.length)return!1;for(var a=0;a<i.length;a++){var s=i[a];if(t[s]!==e[s])return!1}return!0})(this._varibles,a)||(t.extend(this._varibles,a),n(this._varibles,e))},this.stick=function(){if(!p||!u)return!1;n(this._varibles,e)}};function O(){B=k[M],$.text(B),F.text(H),S=new Date(H,M,1).getDay(),T=new Date(H,M+1,0).getDate();for(var e=0;e<S;e++)J.append('<li class="blank"></li>');for(var i=1;i<T+1;i++)i==D&&M==_&&H==w?J.append('<li class="day today tooltip" title="Today">'+i+"</li>"):J.append('<li class="day">'+i+"</li>");t.each(Y,function(t){if(Y[t].eventMonth==M&&Y[t].eventYear==H){let e=J.find("li:nth-of-type("+(Y[t].eventDay+S)+")");if(e.hasClass("has-event"))j.find("#event-"+Y[t].eventDate+" .evt-content").append("<li>"+Y[t].eventDescription+"</li>"),e.find("a").attr("title","View events");else{e.hasClass("today")&&e.removeAttr("title"),e.addClass("has-event").wrapInner('<a href="#event" data-event="'+Y[t].eventDate+'" class="tooltip" title="View event"></a>');const i='<div id="event-'+Y[t].eventDate+'" class="eventbox"><header class="evt-head"><span>'+Y[t].eventDay+", "+B+'</span><a href="#close" class="close-event-button" title="Close"><span class="fx fx-x"></span></a></header><div class="evt-inner"><ul class="evt-content"><li>'+Y[t].eventDescription+"</li></ul></div></div>";j.append(i).find(".evt-inner").overlayScrollbars({className:E})}null!=calendarEvents[t].eventColor&&e.find("a").css("background-color",calendarEvents[t].eventColor)}}),J.find("li.has-event > a").click(function(e){e.preventDefault();const i=t(this).attr("data-event");var n=j.find("#event-"+i),a=n.find("a.close-event-button");return n.show(0,function(){a.click(function(t){t.preventDefault(),n.hide(0)})}),!1}),V.stickySidebar("recalculate")}function N(){r.matches&&!l.hasClass("desktop")?(l.toggleClass("mobile desktop"),v.exists()&&v.prependTo(h),g.exists()&&g.appendTo(y)):r.matches||l.hasClass("mobile")||(l.toggleClass("desktop mobile"),v.exists()&&v.appendTo(d),g.exists()&&g.appendTo(m)),setTimeout(function(){V.stickySidebar("recalculate")},300)}t.fn.stickySidebar=function(e){if(e="string"==typeof e?e:void 0){var i=[];this.each(function(){var e=t(this).data("stickySidebar");i.push(e)});var n=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0,a=[];return this.each(function(t){var s=i[t];if(!s)return console.warn("$.stickySidebar not instantiated yet"),console.info(this),void a.push(void 0);if("function"==typeof s[e]){var o=s[e].apply(s,n);a.push(o)}else console.warn("Method '"+e+"' not defined in $.stickySidebar")}),a.length>1?a:a[0]}return this.each(function(){var e=t(this),i=e.find(".sidebar__inner"),n=new I(e,i);e.data("stickySidebar",n)})},t.fn.photoset=function(){return this.find(".photo-slideshow:not(.processed)").pxuPhotoset({lightbox:!0,highRes:!0,rounded:!1,exif:!1,captions:!1,gutter:i,photoset:".photo-slideshow",photoWrap:".photo-data",photo:".pxu-photo"})},t.fn.video=function(){return this.find(".tmblr-embed:not(.processed)").each(function(){let e=t(this);if(e.find(".instagram-media").exists())e.addClass("processed");else{let t=e.find("iframe").width(),i=e.find("iframe").height(),n=Math.floor(i/t*100)+"%";e.find("iframe").wrap('<div class="vid-resize"/>'),e.find(".vid-resize").css({"padding-Bottom":n}),e.addClass("processed")}})},t.fn.audio=function(){return this.find("iframe.tumblr_audio_player").load(function(){let e=t(this);e.contents().find(".audio-player").css(n).find(".progress").css({background:"rgba(0,0,0,0)"}),e.css({opacity:"1"})})},t.fn.tags=function(){return this.each(function(){if(t(this).hasClass("tagtypea")){let e=t(this).find(".tags");if(e.children().length>a){for(x=1;x<=a;x++)e.find("a.tag:nth-child("+x+")").addClass("visible");e.find("a.tag:nth-child("+a+")").addClass("ellipsis"),e.append('<a href="#expand" class="expand">see all</a>');let i=e.find(".expand");i.click(function(n){n.preventDefault(),e.find(".tag").each(function(){"none"==t(this).css("display")&&t(this).css({display:"inline-block"})}),e.find(".ellipsis").removeClass("ellipsis"),i.hide().remove()})}else e.find("a.tag").addClass("visible");V.stickySidebar("recalculate")}})},t.fn.notecount=function(){return this.find(".notecount").each(function(){let e=function(t){let e=Math.log10(t)/3|0;if(0==e)return t;let i=P[e],n=Math.pow(10,3*e);return+(t/n).toFixed(1)+i}(t(this).text());t(this).text(e)})},!t("#customlinks ul").children().length>0&&t("#customlinks").remove(),t("ul.blogroll-list").exists()&&t("ul.blogroll-list").each(function(){let e=t(this);if(e.children().length>s)for(x=1;x<=s;x++)e.find("li:nth-child("+x+")").addClass("visible");else e.find("li").addClass("visible")}),A(),t.tooltipster.group("tooltip"),l.on("mouseover","#topbar, .sidebar, .notes-wrapper",A),t(".scroll_slider").overlayScrollbars({className:E}),t(".notes-inner").overlayScrollbars({className:E,overflowBehavior:{x:"hidden",y:"scroll"}});var V=t("#left, #right").stickySidebar();if(f?(v.exists()&&v.appendTo(d),g.exists()&&g.appendTo(m)):N(),t(".post:not(.appended)").each(function(){let e=t(this);return e.hasClass("has--caption-visible")&&0==e.find(".caption").children().length&&e.toggleClass("has--caption-visible has--caption-hidden"),e.find(".timeago").timeAgo({time:"letter"}),function(e){e.find("figure").each(function(){null==t(this).attr("class")&&null!=t(this).attr("data-orig-width")||null!=t(this).attr("data-tumblr-attribution")?t(this).wrap('<div class="npf-wrap-single"/>'):"tmblr-full"!=t(this).attr("class")||t(this).parents(".npf_row").exists()||null!=t(this).attr("data-tumblr-attribution")||t(this).addClass("npf-item")}),e.find(".npf_row").each(function(){t(this).addClass("npf-item");var e=t(this).first(".npf_col").find("a.post_media_photo_anchor").attr("data-big-photo-height"),i=t(this).first(".npf_col").find("a.post_media_photo_anchor").attr("data-big-photo-width"),n=Math.floor(e/i*100);t(this).find(".tmblr-full").css("padding-bottom",n+"%")}),e.find(".npf-item").not(".npf-item + .npf-item").each(function(){t(this).nextUntil(":not(.npf-item)").addBack().wrapAll('<div class="npf-wrap-all"/>')})}(e),e.photoset(),e.video(),e.audio(),e.tags().notecount(),e.addClass("appended"),V.stickySidebar("recalculate"),this}),c.imagesLoaded().always(function(t){V.stickySidebar("recalculate")}),g.exists()){var z=l.find("a.calendar-button");z.add(b).click(function(t){t.preventDefault(),l.hasClass("calendar--open")?(l.removeClass("calendar--open"),z.tooltipster("content","Calendar"),m.fadeOut(250)):(l.addClass("calendar--open"),z.tooltipster("content","Close"),m.slideDown(300))});for(var F=g.find(".curr_year"),$=g.find(".curr_month"),j=g.find(".calendar-inner"),J=g.find("ul.cld-grid.days"),Y=[],G=0;G<calendarEvents.length;G++){var L=calendarEvents[G].eventDate.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"");let t={eventDate:calendarEvents[G].eventDate.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,""),eventDay:parseInt(L.slice(0,2)),eventMonth:parseInt(L.slice(2,4))-1,eventYear:parseInt(L.slice(4,8)),eventDescription:calendarEvents[G].eventDescription,eventColor:calendarEvents[G].eventColor};Y.push(t)}O(),g.find("a.month-toggle-buttons").each(function(){t(this).click(function(e){return e.preventDefault(),J.empty(),j.find(".eventbox").remove(),"#prev_month"===t(this).attr("href")?0==M?(M=11,H--):M--:11==M?(M=0,H++):M++,O(),!1})})}t("a.totop-button").click(function(e){return e.preventDefault(),t("html, body").animate({scrollTop:0},600),!1}),f||o.resize(function(){N()}),o.scroll(function(){V.stickySidebar("stick");var t=o.scrollTop();t>200&&!l.hasClass("scrolltop--visible")?l.addClass("scrolltop--visible"):t<=200&&l.hasClass("scrolltop--visible")&&l.removeClass("scrolltop--visible")});let Q=0,R=setInterval(function(){Q<20&&t(".iframe-controls--desktop").exists()?(clearInterval(R),t(".tmblr-iframe--loaded.iframe-controls--desktop").clone().appendTo(".controls_wrapper")):10===Q&&clearInterval(R),Q++},1e3)}(jQuery);
