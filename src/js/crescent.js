/*
 * CRESCENT THEME by https://yeoli-thm.tumblr.com/
 * Copyright (c) 2023 yeoli-thm
 */

!function(t){t.fn.exists=function(){return this.length>0};var e,i,n,a=window.getComputedStyle(document.body),s=a.getPropertyValue("--photosetGutterSize"),o={background:"rgba(0,0,0,0)",color:"rgb("+a.getPropertyValue("--accentTextColor")+")"},l=a.getPropertyValue("--maxTruncatedTags"),r=a.getPropertyValue("--maxBlogFollowings"),d=t(window),c=t("body"),h=window.matchMedia("(min-width: 1248px)"),p=c.find("#container"),f=c.find("#left").find(".sidebar__inner"),u=c.find("#right").find(".sidebar__inner"),v=c.hasClass("sxc"),g=c.hasClass("sxa"),m=CSS.supports("position: sticky"),b=c.find("#featured"),$=c.find("#calendar"),y=c.find("#calendarbox"),C=c.find(".calendar_overlay"),k=c.find("#calendarsection"),w=["January","February","March","April","May","June","July","August","September","October","November","December"];let _=new Date,S=_.getFullYear(),D=_.getMonth(),N=_.getDate();var B=S,T=D,A=c.hasClass("sbdark")?"os-theme-thin-dark":"os-theme-thin-light",H=["","k","M","G","T","P","E"];function M(){t("[title]").tooltipster({anchor:"top-left",offset:[14,-18],plugins:["follower"],animationDuration:300,delay:100,updateAnimation:null,trigger:"custom",triggerOpen:{click:!0,mouseenter:!0,tap:!1,touchstart:!1},triggerClose:{click:!1,mouseleave:!0,originClick:!1,scroll:!0,tap:!0,touchleave:!0}})}var V=function(e,i){function n(t,e){var i=d.scrollTop(),n=t;h.matches&&n.containerHeight>n.vpHeight?n.elemHeight>n.vpHeight-80&&n.containerHeight>n.elemHeight?(e.hasClass("sticky--top")&&e.removeClass("sticky--top"),i<=n.elemBottom?e.removeClass("sticky--bottom sticky--end"):i>n.elemBottom&&i<=n.containerBottom?e.hasClass("sticky--bottom")||e.removeClass("sticky--end").addClass("sticky--bottom"):i>n.containerBottom&&!e.hasClass("sticky--end")&&e.removeClass("sticky--bottom").addClass("sticky--end")):e.hasClass("sticky--top")||e.removeClass("sticky--bottom sticky--end").addClass("sticky--top"):h.matches||e.removeClass("sticky--top sticky--bottom sticky--end")}this._varibles={vpHeight:d.height(),containerHeight:p.height(),containerBottom:p.height()+p.offset().top-d.height()+40,elemHeight:i.height(),elemBottom:i.height()+p.offset().top-d.height()},this.recalculate=function(){if(!g||!m)return!1;var a={vpHeight:d.height(),containerHeight:p.height(),containerBottom:p.height()+p.offset().top-d.height()+40,elemHeight:i.height(),elemBottom:i.height()+p.offset().top-d.height()};!function t(e,i){var n=Object.getOwnPropertyNames(e),a=Object.getOwnPropertyNames(i);if(n.length!=a.length)return!1;for(var s=0;s<n.length;s++){var o=n[s];if(e[o]!==i[o])return!1}return!0}(this._varibles,a)&&(t.extend(this._varibles,a),n(this._varibles,e))},this.stick=function(){if(!g||!m)return!1;n(this._varibles,e)}};function E(){n=w[T],F.text(n),O.text(B),e=new Date(B,T,1).getDay(),i=new Date(B,T+1,0).getDate();for(var a=0;a<e;a++)Y.append('<li class="blank"></li>');for(var s=1;s<i+1;s++)s==N&&T==D&&B==S?Y.append('<li class="day today tooltip" title="Today">'+s+"</li>"):Y.append('<li class="day">'+s+"</li>");t.each(G,function(t){if(G[t].eventMonth==T&&G[t].eventYear==B){let i=Y.find("li:nth-of-type("+(G[t].eventDay+e)+")");if(i.hasClass("has-event"))J.find("#event-"+G[t].eventDate+" .evt-content").append("<li>"+G[t].eventDescription+"</li>"),i.find("a").attr("title","View events");else{i.hasClass("today")&&i.removeAttr("title"),i.addClass("has-event").wrapInner('<a href="#event" data-event="'+G[t].eventDate+'" class="tooltip" title="View event"></a>');let a='<div id="event-'+G[t].eventDate+'" class="eventbox"><header class="evt-head"><span>'+G[t].eventDay+", "+n+'</span><a href="#close" class="close-event-button" title="Close"><span class="fx fx-x"></span></a></header><div class="evt-inner"><ul class="evt-content"><li>'+G[t].eventDescription+"</li></ul></div></div>";J.append(a).find(".evt-inner").overlayScrollbars({className:A})}void 0!=calendarEvents[t].eventColor&&i.find("a").css("background-color",calendarEvents[t].eventColor)}}),Y.find("li.has-event > a").click(function(e){e.preventDefault();var i=t(this);let n=i.attr("data-event");var a=J.find("#event-"+n),s=a.find("a.close-event-button");return a.show(0,function(){s.click(function(t){t.preventDefault(),a.hide(0)})}),!1}),z.stickySidebar("recalculate")}function P(){h.matches&&!c.hasClass("desktop")?(c.toggleClass("mobile desktop"),b.exists()&&b.prependTo(u),$.exists()&&$.appendTo(k)):h.matches||c.hasClass("mobile")||(c.toggleClass("desktop mobile"),b.exists()&&b.appendTo(f),$.exists()&&$.appendTo(y)),setTimeout(function(){z.stickySidebar("recalculate")},300)}t.fn.stickySidebar=function(e){var e="string"==typeof e?e:void 0;if(!e)return this.each(function e(){var i=t(this),n=i.find(".sidebar__inner"),a=new V(i,n);i.data("stickySidebar",a)});var i=[];this.each(function e(){var n=t(this).data("stickySidebar");i.push(n)});var n=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0,a=[];return this.each(function t(s){var o=i[s];if(!o){console.warn("$.stickySidebar not instantiated yet"),console.info(this),a.push(void 0);return}if("function"==typeof o[e]){var l=o[e].apply(o,n);a.push(l)}else console.warn("Method '"+e+"' not defined in $.stickySidebar")}),a.length>1?a:a[0]},t.fn.photoset=function(){return this.find(".photo-slideshow:not(.processed)").pxuPhotoset({lightbox:!0,highRes:!0,rounded:!1,exif:!1,captions:!1,gutter:s,photoset:".photo-slideshow",photoWrap:".photo-data",photo:".pxu-photo"})},t.fn.video=function(){return this.find(".tmblr-embed:not(.processed)").each(function(){let e=t(this);if(e.find(".instagram-media").exists())e.addClass("processed");else{let i=e.find("iframe").width(),n=e.find("iframe").height();e.find("iframe").wrap('<div class="vid-resize"/>'),e.find(".vid-resize").css({"padding-Bottom":Math.floor(n/i*100)+"%"}),e.addClass("processed")}})},t.fn.npfChat=function(){return this.find(".npf_chat").each(function(){var e=t(this);e.prepend("<br>").append("<br>"),e.find("br").each(function(e){t(this).attr("class",e)});let i=e.children("br").length;for(let n=1;n<i;n++){var a=n-1,s=n,o=e.contents(),l=o.index(e.find('br[class="'+a+'"]')),r=o.index(e.find('br[class="'+s+'"]'));o.slice(l,r).wrapAll("<li>"),n==i-1&&(e.find("br").remove(),e.find("b").addClass("subfont"),e.html('<ul class="post-chat resetlist">'+e.html()+"</ul>").contents().unwrap())}})},t.fn.npfLink=function(){return this.find(".npf-link-block").each(function(){var e=t(this),i=t(this).find("a").attr("href"),n=t(this).find(".title").exists()?"<h3>"+t(this).find(".title").text()+'<span class="fx fx-chevron-right"></span></h3>':"";e.replaceWith('<a class="npf-post-link" href="'+i+'" target="_blank">'+n+'<i data-feather="chevron-right"></i></div>')})},t.fn.tags=function(){return this.each(function(){if(t(this).hasClass("tagtypea")){let e=t(this).find(".tags"),i=e.children().length;if(i>l){for(x=1;x<=l;x++)e.find("a.tag:nth-child("+x+")").addClass("visible");e.find("a.tag:nth-child("+l+")").addClass("ellipsis"),e.append('<a href="#expand" class="expand">see all</a>');let n=e.find(".expand");n.click(function(i){i.preventDefault(),e.find(".tag").each(function(){"none"==t(this).css("display")&&t(this).css({display:"inline-block"})}),e.find(".ellipsis").removeClass("ellipsis"),n.hide().remove()})}else e.find("a.tag").addClass("visible");z.stickySidebar("recalculate")}})},t.fn.notecount=function(){return this.find(".notecount").each(function(){let e=t(this).text(),i=function t(e){let i=Math.log10(e)/3|0;if(0==i)return e;let n=H[i];return+(e/Math.pow(10,3*i)).toFixed(1)+n}(e);t(this).text(i)})},!t("#customlinks ul").children().length>0&&t("#customlinks").remove(),t("ul.blogroll-list").exists()&&t("ul.blogroll-list").each(function(){let e=t(this),i=e.children().length;if(i>r)for(x=1;x<=r;x++)e.find("li:nth-child("+x+")").addClass("visible");else e.find("li").addClass("visible")}),M(),t.tooltipster.group("tooltip"),c.on("mouseover","#topbar, .sidebar, .notes-wrapper",M),t(".scroll_slider").overlayScrollbars({className:A}),t(".notes-inner").overlayScrollbars({className:A,overflowBehavior:{x:"hidden",y:"scroll"}});var z=t("#left, #right").stickySidebar();if(v?(b.exists()&&b.appendTo(f),$.exists()&&$.appendTo(y)):P(),t(".post:not(.appended)").each(function(){var e,i;let n=t(this);return n.hasClass("has--caption-visible")&&0==n.find(".caption").children().length&&n.toggleClass("has--caption-visible has--caption-hidden"),n.find(".timeago").timeAgo({time:"letter"}),(e=n).find("iframe.tumblr_audio_player").load(function(){var e=t(this);e.contents().find(".audio-player").css(o).find(".progress").css({background:"rgba(0,0,0,0)"}),e.css({opacity:"1"})}),e.find(".audio-caption:not(.processed)").each(function(){var e=t(this),i=e.next("audio").children("source").attr("src");e.addClass("processed");var n=e.find("img.album-cover").exists()?'<img src="'+e.find("img.album-cover").attr("src")+'" alt=""/>':"";e.append('<div class="audio-wrapper"><div class="album-art">'+n+'</div><div class="svgaudiobutton"><svg class="playbutton"><use xlink:href="#playButton"/></svg><svg class="pausebutton"><use xlink:href="#pauseButton"/></svg></div></div>');var a=e.find(".svgaudiobutton"),s=new Audio(i);s.addEventListener("canplay",function(){a.addClass("playable")}),s.addEventListener("timeupdate",function(){var t=s.duration;s.currentTime==t&&a.removeClass("playing").addClass("paused")}),a.click(function(){!1==s.paused?(a.removeClass("playing").addClass("paused"),s.pause()):(a.removeClass("paused").addClass("playing"),s.play())})}),(i=n).find("figure").each(function(){void 0==t(this).attr("class")&&void 0!=t(this).attr("data-orig-width")||void 0!=t(this).attr("data-tumblr-attribution")?t(this).wrap('<div class="npf-wrap-single"/>'):"tmblr-full"!=t(this).attr("class")||t(this).parents(".npf_row").exists()||void 0!=t(this).attr("data-tumblr-attribution")||t(this).addClass("npf-item")}),i.find(".npf_row").each(function(){t(this).addClass("npf-item")}),i.find(".npf-item").not(".npf-item + .npf-item").each(function(){t(this).nextUntil(":not(.npf-item)").addBack().wrapAll('<div class="npf-wrap-all"/>')}),n.photoset(),n.video(),n.npfChat(),n.npfLink(),n.tags().notecount(),n.addClass("appended"),z.stickySidebar("recalculate"),this}),p.imagesLoaded().always(function(t){z.stickySidebar("recalculate")}),t("#mainbody").each(function(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","symbol"),n=document.createElementNS("http://www.w3.org/2000/svg","symbol"),a=document.createElementNS("http://www.w3.org/2000/svg","path"),s=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M3.947,20.834V3.166l16.105,8.833L3.947,20.834L3.947,20.834z"),i.setAttributeNS(null,"id","playButton"),i.setAttributeNS(null,"viewbox","0 0 24 24"),i.appendChild(a),s.setAttributeNS(null,"d","M3.897,3.6h6.569v16.8H3.897V3.6z M13.534,3.6h6.568v16.8h-6.568V3.6z"),n.setAttributeNS(null,"id","pauseButton"),n.setAttributeNS(null,"viewbox","0 0 24 24"),n.appendChild(s),e.setAttributeNS(null,"width","0"),e.setAttributeNS(null,"height","0"),e.appendChild(i),e.appendChild(n),t(this).append(e)}),$.exists()){var L=c.find("a.calendar-button");L.add(C).click(function(t){t.preventDefault(),c.hasClass("calendar--open")?(c.removeClass("calendar--open"),L.tooltipster("content","Calendar"),y.fadeOut(250)):(c.addClass("calendar--open"),L.tooltipster("content","Close"),y.slideDown(300))});for(var O=$.find(".curr_year"),F=$.find(".curr_month"),J=$.find(".calendar-inner"),Y=$.find("ul.cld-grid.days"),G=[],W=0;W<calendarEvents.length;W++){var I=calendarEvents[W].eventDate.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"");let R={eventDate:calendarEvents[W].eventDate.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,""),eventDay:parseInt(I.slice(0,2)),eventMonth:parseInt(I.slice(2,4))-1,eventYear:parseInt(I.slice(4,8)),eventDescription:calendarEvents[W].eventDescription,eventColor:calendarEvents[W].eventColor};G.push(R)}E(),$.find("a.month-toggle-buttons").each(function(){t(this).click(function(e){return e.preventDefault(),Y.empty(),J.find(".eventbox").remove(),"#prev_month"===t(this).attr("href")?0==T?(T=11,B--):T--:11==T?(T=0,B++):T++,E(),!1})})}t("a.totop-button").click(function(e){return e.preventDefault(),t("html, body").animate({scrollTop:0},600),!1}),v||d.resize(function(){P()}),d.scroll(function(){z.stickySidebar("stick");var t=d.scrollTop();t>200&&!c.hasClass("scrolltop--visible")?c.addClass("scrolltop--visible"):t<=200&&c.hasClass("scrolltop--visible")&&c.removeClass("scrolltop--visible")});let U=0,j=setInterval(function(){U<20&&t(".iframe-controls--desktop").exists()?(clearInterval(j),t(".tmblr-iframe--loaded.iframe-controls--desktop").clone().appendTo(".controls_wrapper")):10===U&&clearInterval(j),U++},1e3)}(jQuery);
