/*
 * SPRING AGAIN by https://yeoli-thm.tumblr.com/
 * Copyright (c) 2022 yeoli-thm
 */

!function(a){a.fn.exists=function(){return this.length>0};var j,k,l,m=window.getComputedStyle(document.body).getPropertyValue("--postPhotosetGutterSize"),c=a(window),b=a("body"),n=b.find("#mainbody-wrapper"),d=b.find("#sidebar"),o=d.find(".sidebar_inner"),p=d.find("#blogtitle"),f=d.find(".date-sticker"),g=b.find("button.menubutton"),q=window.matchMedia("(min-width: 1024px)"),r=!1,s=!1,t=!1,u=c.scrollTop();function e(){a("[title]").tooltipster({anchor:"top-left",offset:[14,-18],plugins:["follower"],animationDuration:300,delay:100,updateAnimation:null,trigger:"custom",triggerOpen:{click:!0,mouseenter:!0,tap:!1,touchstart:!1},triggerClose:{click:!1,mouseleave:!0,originClick:!1,scroll:!0,tap:!0,touchleave:!0}})}function v(){!0==s&& !1==t?d.hasClass("fixed--top")||d.addClass("fixed--top").removeClass("fixed--bottom"):!1==s&& !0==t?(d.hasClass("fixed--top")&&d.removeClass("fixed--top"),u>l-j&&!d.hasClass("fixed--bottom")?d.addClass("fixed--bottom"):u<=l-j&&d.hasClass("fixed--bottom")&&d.removeClass("fixed--bottom")):!1==s&& !1==t&&(d.hasClass("fixed--top")&&d.removeClass("fixed--top"),d.hasClass("fixed--bottom")&&d.removeClass("fixed--bottom"))}function h(a){p.delay(a).animate({width:z.width()},300,function(){j=window.innerHeight,k=n.outerHeight(),l=o.outerHeight(),!0==(r=r=!!q.matches)?l>j?(t=k>l,s=!1):(s=!0,t=!1):(s=!1,t=!1),v()})}function w(b,a){var c=b.find('[class*="thumbody-"]');if("video"==a.type)c.html('<figure class="thumbody-video"><div class="tb_videoicon"><i class="ph ph-play-fill"></i></div></figure>').contents().unwrap(),a.hasOwnProperty("poster")&&b.find(".thumbody-video").prepend('<img src="'+a.poster[0].url+'" alt="Image"/>'),b.find(".npf-obj").remove();else if("image"==a.type){var d=a.media;let e=d[0].url;c.html('<figure class="thumbody-photo"><img src="'+e+'" alt="Image"/></figure>').contents().unwrap(),b.find(".npf-obj").remove()}else if("audio"==a.type){let f=a.hasOwnProperty("poster")?'<div class="tb_audio_art"><img src="'+a.poster[0].url+'" alt="Image"/></div>':'<div class="tb_audio_noart"><i class="ph ph-music-notes-fill"></i></div>',g=a.hasOwnProperty("title")?'<span class="tb_audio_trackname">'+a.title+"</span>":"",h=a.hasOwnProperty("artist")?'<span class="tb_audio_artist">'+a.artist+"</span>":"";c.html('<div class="thumbody-audio">'+f+'<div class="tb_audio_info"><div class="tb_audio_playicon"><i class="ph ph-play-fill"></i></div><div class="tb_audio_infoinner">'+g+h+"</div></div></div>").contents().unwrap(),b.find(".npf-obj").remove()}}function x(d,b,c){if("audio"==b[c].type&&"tumblr"==b[c].provider){let e=b[c].media.url;d.find(".npf-tmblr-audio .post_audio_block:not(processed)").each(function(){var d=a(this);if(d.find("source").attr("src")==e){let f=b[c].hasOwnProperty("poster")?'<div class="circle_sticker"></div>':"",g=b[c].hasOwnProperty("poster")?'<div class="post_audioart"><img src="'+b[c].poster[0].url+'" alt=""/></div>':"",h=b[c].hasOwnProperty("title")?'<span class="audiotrackname">'+b[c].title+"</span>":"",i=b[c].hasOwnProperty("artist")?'<span class="audioartist">'+b[c].artist+"</span>":"";d.html(g+'<div class="audioinfo">'+h+i+'</div><div class="audiobar"><div class="audioscrubber"></div></div><div class="audiocontrols"><div class="audioicon"><i class="ph ph-rewind-fill"></i></div><div class="audiobutton paused"><i class="ph ph-play-fill"></i><i class="ph ph-pause-fill"></i><span class="sr-only">Play/pause song</span></div><div class="audioicon"><i class="ph ph-fast-forward-fill"></i></div></div>').after(f),y(d,e),d.addClass("processed")}})}}function y(b,d){var e=b.find(".audiobutton"),f=b.find(".audiobar"),g=b.find(".audioscrubber"),c=new Audio(d);c.addEventListener("canplay",function(){b.addClass("playable")}),c.addEventListener("timeupdate",function(){var a=c.duration,b=c.currentTime;b==a&&e.removeClass("playing").addClass("paused"),g.css("width",100*(b/a)+"%")}),e.click(function(){!1==c.paused?(e.removeClass("playing").addClass("paused"),c.pause()):(e.removeClass("paused").addClass("playing"),c.play())}),f.click(function(d){var e=a(this).width(),b=(d.pageX-a(this).offset().left)/e;c.currentTime=b*c.duration,g.css("width",100*b+"%")})}a.fn.photoset=function(){return this.find(".photo-slideshow:not(.processed)").pxuPhotoset({lightbox:!0,highRes:!0,rounded:!1,exif:!1,captions:!1,gutter:m,photoset:".photo-slideshow",photoWrap:".photo-data",photo:".pxu-photo"})},a.fn.video=function(){return this.find(".tmblr-embed:not(.processed)").each(function(){let b=a(this);if(b.find(".instagram-media").exists())b.addClass("processed");else{let c=b.find("iframe").width(),d=b.find("iframe").height(),e=Math.floor(d/c*100)+"%";b.find("iframe").wrap('<div class="vid-resize"/>'),b.find(".vid-resize").css({"padding-Bottom":e}),b.addClass("processed")}})},a.fn.npfChat=function(){return this.find(".npf_chat").each(function(){var b=a(this);b.prepend("<br>").append("<br>"),b.find("br").each(function(b){a(this).attr("class",b)});let e=b.children("br").length;for(let c=1;c<e;c++){var f=c-1,g=c,d=b.contents(),h=d.index(b.find('br[class="'+f+'"]')),i=d.index(b.find('br[class="'+g+'"]'));d.slice(h,i).wrapAll("<li>"),c==e-1&&(b.find("br").remove(),b.html('<ul class="post_chat resetlist">'+b.html()+"</ul>").contents().unwrap())}})},a(document).ready(function(){a("#preload, #spinner").addClass("fadeout"),setTimeout(function(){b.removeClass("preinitialize")},1400)}),e(),a.tooltipster.group("tooltip"),b.on("mouseover","#sidebar, .notes",e),g.click(function(a){return a.preventDefault(),b.hasClass("menu--opened")?(b.removeClass("menu--opened"),setTimeout(function(){d.css("display","none")},500)):d.show(0,function(){b.addClass("menu--opened"),z.masonry("layout")}),!1}),f.each(function(){let b=new Date;a(this).find(".day").text((10>b.getDate()?"0":"")+b.getDate()),a(this).find(".month").text(b.toLocaleString("en-us",{month:"short"}))});var z=a(".sidebar_content").masonry({itemSelector:".sidebar-item",columnWidth:1,fitWidth:!0});h(300);var i=_.debounce(function(){u=a(this).scrollTop(),h(0)},300);c.resize(i),c.scroll(function(){u=a(this).scrollTop(),v()}),a(".post:not(.loaded), .thumbnail:not(.loaded)").each(function(){var c,b=a(this);if(b.hasClass("thumbnail")){let d=b.attr("data-item-type");("text"==d||"audio-embed"==d)&&function(a){var e=JSON.parse(a.find(".npf-obj").text()),b=e.content,c=e.trail;if(b.length>0){var d=b[0];w(a,d)}else if(0===b.length&&c.length>0&&c[0].content.length>0){var d=c[0].content[0];w(a,d)}}(b)}b.photoset(),b.video(),b.npfChat(),(c=b).find("figure").each(function(){var b=a(this);b.find("audio").exists()?b.addClass("npf-tmblr-audio").wrapInner('<div class="post_audio_block"></div>'):b.hasClass("tmblr-embed")||(void 0==b.attr("class")&& void 0!=b.attr("data-orig-width")|| void 0!=b.attr("data-tumblr-attribution")?b.wrap('<div class="npf-photo-single"/>'):"tmblr-full"!=b.attr("class")||b.parents(".npf_row").exists()|| void 0!=b.attr("data-tumblr-attribution")||b.addClass("npf-photo-item"))}),c.find(".npf_row").each(function(){a(this).addClass("npf-photo-item")}),c.find(".npf-photo-item").not(".npf-photo-item + .npf-photo-item").each(function(){a(this).nextUntil(":not(.npf-photo-item)").addBack().wrapAll('<div class="npf-photo-group"/>')}),c.find('[class*="npf-photo-"] img:not(.post_media_photo)').each(function(){var b=a(this),c=b.attr("src"),d=b.attr("data-orig-height"),e=b.attr("data-orig-width");b.wrap('<a class="post_media_photo_anchor" data-big-photo="'+c+'" data-big-photo-height="'+d+'" data-big-photo-width="'+e+'"/>')}),function(b){if(b.find(".post_audio_block.native:not(.processed)").exists()&&b.find(".post_audio_block.native:not(.processed)").each(function(){var b=a(this),c=b.find(".tumblr_audio_player");let d=c.attr("src"),e=d.split("audio_file=")[1].split(".mp3")[0],f=e.replace(/%3A/g,":").replace(/%2F/g,"/")+".mp3";y(b,f),b.addClass("processed")}),b.find(".npf-tmblr-audio").exists()){var h=JSON.parse(b.find(".npf-obj").text()),c=h.content,d=h.trail;if(c.length>0)for(let e=0;e<c.length;e++)x(b,c,e);if(d.length>0)for(let f=0;f<d.length;f++){var i=d[f].content;for(let g=0;g<i.length;g++)x(b,i,g)}}}(b),b.addClass("loaded")})}(jQuery)
