/*
 * SPRING AGAIN by https://yeoli-thm.tumblr.com/
 * Copyright (c) 2024 yeoli-thm
 */

!function(t){t.fn.exists=function(){return this.length>0};var i,a,e,s=window.getComputedStyle(document.body).getPropertyValue("--postPhotosetGutterSize"),o=t(window),n=t("body"),d=n.find("#mainbody-wrapper"),l=n.find("#sidebar"),r=l.find(".sidebar_inner"),p=l.find("#blogtitle"),c=l.find(".date-sticker"),f=n.find("button.menubutton"),h=window.matchMedia("(min-width: 1024px)"),u=!1,m=!1,v=!1,b=o.scrollTop();function g(){t("[title]").tooltipster({anchor:"top-left",offset:[14,-18],plugins:["follower"],animationDuration:300,delay:100,updateAnimation:null,trigger:"custom",triggerOpen:{click:!0,mouseenter:!0,tap:!1,touchstart:!1},triggerClose:{click:!1,mouseleave:!0,originClick:!1,scroll:!0,tap:!0,touchleave:!0}})}function $(){!0==m&&!1==v?l.hasClass("fixed--top")||l.addClass("fixed--top").removeClass("fixed--bottom"):!1==m&&!0==v?(l.hasClass("fixed--top")&&l.removeClass("fixed--top"),b>e-i&&!l.hasClass("fixed--bottom")?l.addClass("fixed--bottom"):b<=e-i&&l.hasClass("fixed--bottom")&&l.removeClass("fixed--bottom")):!1==m&&!1==v&&(l.hasClass("fixed--top")&&l.removeClass("fixed--top"),l.hasClass("fixed--bottom")&&l.removeClass("fixed--bottom"))}function y(t){p.delay(t).animate({width:k.width()},300,function(){i=window.innerHeight,a=d.outerHeight(),e=r.outerHeight(),!0==(u=u=!!h.matches)?e>i?(v=a>e,m=!1):(m=!0,v=!1):(m=!1,v=!1),$()})}function C(t,i){var a=t.find('[class*="thumbody-"]');if("video"==i.type)a.html('<figure class="thumbody-video"><div class="tb_videoicon"><i class="ph ph-play-fill"></i></div></figure>').contents().unwrap(),i.hasOwnProperty("poster")&&t.find(".thumbody-video").prepend('<img src="'+i.poster[0].url+'" alt="Image"/>'),t.find(".npf-obj").remove();else if("image"==i.type){var e=i.media;let s=e[0].url;a.html('<figure class="thumbody-photo"><img src="'+s+'" alt="Image"/></figure>').contents().unwrap(),t.find(".npf-obj").remove()}else if("audio"==i.type){let o=i.hasOwnProperty("poster")?'<div class="tb_audio_art"><img src="'+i.poster[0].url+'" alt="Image"/></div>':'<div class="tb_audio_noart"><i class="ph ph-music-notes-fill"></i></div>',n=i.hasOwnProperty("title")?'<span class="tb_audio_trackname">'+i.title+"</span>":"",d=i.hasOwnProperty("artist")?'<span class="tb_audio_artist">'+i.artist+"</span>":"";a.html('<div class="thumbody-audio">'+o+'<div class="tb_audio_info"><div class="tb_audio_playicon"><i class="ph ph-play-fill"></i></div><div class="tb_audio_infoinner">'+n+d+"</div></div></div>").contents().unwrap(),t.find(".npf-obj").remove()}}function w(i,a,e){if("audio"==a[e].type&&"tumblr"==a[e].provider){let s=a[e].media.url;i.find(".npf-tmblr-audio .post_audio_block:not(processed)").each(function(){var i=t(this);if(i.find("source").attr("src")==s){let o=a[e].hasOwnProperty("poster")?'<div class="circle_sticker"></div>':"",n=a[e].hasOwnProperty("poster")?'<div class="post_audioart"><img src="'+a[e].poster[0].url+'" alt=""/></div>':"",d=a[e].hasOwnProperty("title")?'<span class="audiotrackname">'+a[e].title+"</span>":"",l=a[e].hasOwnProperty("artist")?'<span class="audioartist">'+a[e].artist+"</span>":"";i.html(n+'<div class="audioinfo">'+d+l+'</div><div class="audiobar"><div class="audioscrubber"></div></div><div class="audiocontrols"><div class="audioicon"><i class="ph ph-rewind-fill"></i></div><div class="audiobutton paused"><i class="ph ph-play-fill"></i><i class="ph ph-pause-fill"></i><span class="sr-only">Play/pause song</span></div><div class="audioicon"><i class="ph ph-fast-forward-fill"></i></div></div>').after(o),x(i,s),i.addClass("processed")}})}}function x(i,a){var e=i.find(".audiobutton"),s=i.find(".audiobar"),o=i.find(".audioscrubber"),n=new Audio(a);n.addEventListener("canplay",function(){i.addClass("playable")}),n.addEventListener("timeupdate",function(){var t=n.duration,i=n.currentTime;i==t&&e.removeClass("playing").addClass("paused"),o.css("width",100*(i/t)+"%")}),e.click(function(){!1==n.paused?(e.removeClass("playing").addClass("paused"),n.pause()):(e.removeClass("paused").addClass("playing"),n.play())}),s.click(function(i){var a=t(this).width(),e=(i.pageX-t(this).offset().left)/a;n.currentTime=e*n.duration,o.css("width",100*e+"%")})}t.fn.photoset=function(){return this.find(".photo-slideshow:not(.processed)").pxuPhotoset({lightbox:!0,highRes:!0,rounded:!1,exif:!1,captions:!1,gutter:s,photoset:".photo-slideshow",photoWrap:".photo-data",photo:".pxu-photo"})},t.fn.video=function(){return this.find(".tmblr-embed:not(.processed)").each(function(){let i=t(this);if(i.find(".instagram-media").exists())i.addClass("processed");else{let a=i.find("iframe").width(),e=i.find("iframe").height();i.find("iframe").wrap('<div class="vid-resize"/>'),i.find(".vid-resize").css({"padding-Bottom":Math.floor(e/a*100)+"%"}),i.addClass("processed")}})},t.fn.npfChat=function(){return this.find(".npf_chat").each(function(){var i=t(this);i.prepend("<br>").append("<br>"),i.find("br").each(function(i){t(this).attr("class",i)});let a=i.children("br").length;for(let e=1;e<a;e++){var s=e-1,o=e,n=i.contents(),d=n.index(i.find('br[class="'+s+'"]')),l=n.index(i.find('br[class="'+o+'"]'));n.slice(d,l).wrapAll("<li>"),e==a-1&&(i.find("br").remove(),i.html('<ul class="post_chat resetlist">'+i.html()+"</ul>").contents().unwrap())}})},t(document).ready(function(){t("#preload, #spinner").addClass("fadeout"),setTimeout(function(){n.removeClass("preinitialize")},1400)}),g(),t.tooltipster.group("tooltip"),n.on("mouseover","#sidebar, .notes",g),f.click(function(t){return t.preventDefault(),n.hasClass("menu--opened")?(n.removeClass("menu--opened"),setTimeout(function(){l.css("display","none")},500)):l.show(0,function(){n.addClass("menu--opened"),k.masonry("layout")}),!1}),c.each(function(){let i=new Date;t(this).find(".day").text((10>i.getDate()?"0":"")+i.getDate()),t(this).find(".month").text(i.toLocaleString("en-us",{month:"short"}))});var k=t(".sidebar_content").masonry({itemSelector:".sidebar-item",columnWidth:1,fitWidth:!0});y(300);var P=_.debounce(function(){b=t(this).scrollTop(),y(0)},300);o.resize(P),o.scroll(function(){b=t(this).scrollTop(),$()}),t(".post:not(.loaded), .thumbnail:not(.loaded)").each(function(){var i,a=t(this);if(a.hasClass("thumbnail")){let e=a.attr("data-item-type");("text"==e||"audio-embed"==e)&&function t(i){var a=JSON.parse(i.find(".npf-obj").text()),e=a.content,s=a.trail;if(e.length>0){var o=e[0];C(i,o)}else if(0===e.length&&s.length>0&&s[0].content.length>0){var o=s[0].content[0];C(i,o)}}(a)}a.photoset(),a.video(),a.npfChat(),(i=a).find("figure").each(function(){var i=t(this);i.find("audio").exists()?i.addClass("npf-tmblr-audio").wrapInner('<div class="post_audio_block"></div>'):i.hasClass("tmblr-embed")||(void 0==i.attr("class")&&void 0!=i.attr("data-orig-width")||void 0!=i.attr("data-tumblr-attribution")?i.wrap('<div class="npf-photo-single"/>'):"tmblr-full"!=i.attr("class")||i.parents(".npf_row").exists()||void 0!=i.attr("data-tumblr-attribution")||i.addClass("npf-photo-item"))}),i.find(".npf_row").each(function(){t(this).addClass("npf-photo-item")}),i.find(".npf-photo-item").not(".npf-photo-item + .npf-photo-item").each(function(){t(this).nextUntil(":not(.npf-photo-item)").addBack().wrapAll('<div class="npf-photo-group"/>')}),i.find('[class*="npf-photo-"] img:not(.post_media_photo)').each(function(){var i=t(this),a=i.attr("src"),e=i.attr("data-orig-height"),s=i.attr("data-orig-width");i.wrap('<a class="post_media_photo_anchor" data-big-photo="'+a+'" data-big-photo-height="'+e+'" data-big-photo-width="'+s+'"/>')}),function i(a){if(a.find(".post_audio_block.native:not(.processed)").exists()&&a.find(".post_audio_block.native:not(.processed)").each(function(){var i=t(this),a=i.find(".tumblr_audio_player");let e=a.attr("src"),s=e.split("audio_file=")[1].split(".mp3")[0],o=s.replace(/%3A/g,":").replace(/%2F/g,"/")+".mp3";x(i,o),i.addClass("processed")}),a.find(".npf-tmblr-audio").exists()){var e=JSON.parse(a.find(".npf-obj").text()),s=e.content,o=e.trail;if(s.length>0)for(let n=0;n<s.length;n++)w(a,s,n);if(o.length>0)for(let d=0;d<o.length;d++){var l=o[d].content;for(let r=0;r<l.length;r++)w(a,l,r)}}}(a),a.addClass("loaded")}),t("small").each(function(){if(t(this).children("small").length>0){var i=t(this).addClass("outersmall");t(this).children("small").addClass("innersmall").children().unwrap(),i.children().unwrap()}})}(jQuery);
