/*
 * SPRING AGAIN by https://yeoli-thm.tumblr.com/
 * Copyright (c) 2024 yeoli-thm
 */

!function(t){t.fn.exists=function(){return this.length>0};var i,e,a,s=window.getComputedStyle(document.body).getPropertyValue("--postPhotosetGutterSize"),o=t(window),n=t("body"),d=n.find("#mainbody-wrapper"),l=n.find("#sidebar"),r=l.find(".sidebar_inner"),p=l.find("#blogtitle"),c=l.find(".date-sticker"),h=n.find("button.menubutton"),f=window.matchMedia("(min-width: 1024px)"),u=!1,m=!1,v=!1,b=o.scrollTop();function g(){t("[title]").tooltipster({anchor:"top-left",offset:[14,-18],plugins:["follower"],animationDuration:300,delay:100,updateAnimation:null,trigger:"custom",triggerOpen:{click:!0,mouseenter:!0,tap:!1,touchstart:!1},triggerClose:{click:!1,mouseleave:!0,originClick:!1,scroll:!0,tap:!0,touchleave:!0}})}function $(){!0==m&&!1==v?l.hasClass("fixed--top")||l.addClass("fixed--top").removeClass("fixed--bottom"):!1==m&&!0==v?(l.hasClass("fixed--top")&&l.removeClass("fixed--top"),b>a-i&&!l.hasClass("fixed--bottom")?l.addClass("fixed--bottom"):b<=a-i&&l.hasClass("fixed--bottom")&&l.removeClass("fixed--bottom")):!1==m&&!1==v&&(l.hasClass("fixed--top")&&l.removeClass("fixed--top"),l.hasClass("fixed--bottom")&&l.removeClass("fixed--bottom"))}function y(t){p.delay(t).animate({width:k.width()},300,function(){i=window.innerHeight,e=d.outerHeight(),a=r.outerHeight(),!0==(u=u=!!f.matches)?a>i?(v=e>a,m=!1):(m=!0,v=!1):(m=!1,v=!1),$()})}function w(t,i){var e=t.find('[class*="thumbody-"]');if("video"==i.type)e.html('<figure class="thumbody-video"><div class="tb_videoicon"><i class="ph ph-play-fill"></i></div></figure>').contents().unwrap(),i.hasOwnProperty("poster")&&t.find(".thumbody-video").prepend('<img src="'+i.poster[0].url+'" alt="Image"/>'),t.find(".npf-obj").remove();else if("image"==i.type){var a=i.media;let s=a[0].url;e.html('<figure class="thumbody-photo"><img src="'+s+'" alt="Image"/></figure>').contents().unwrap(),t.find(".npf-obj").remove()}else if("audio"==i.type){let o=i.hasOwnProperty("poster")?'<div class="tb_audio_art"><img src="'+i.poster[0].url+'" alt="Image"/></div>':'<div class="tb_audio_noart"><i class="ph ph-music-notes-fill"></i></div>',n=i.hasOwnProperty("title")?'<span class="tb_audio_trackname">'+i.title+"</span>":"",d=i.hasOwnProperty("artist")?'<span class="tb_audio_artist">'+i.artist+"</span>":"";e.html('<div class="thumbody-audio">'+o+'<div class="tb_audio_info"><div class="tb_audio_playicon"><i class="ph ph-play-fill"></i></div><div class="tb_audio_infoinner">'+n+d+"</div></div></div>").contents().unwrap(),t.find(".npf-obj").remove()}}function C(i,e,a){if("audio"==e[a].type&&"tumblr"==e[a].provider){let s=e[a].media.url;i.find(".npf-tmblr-audio .post_audio_block:not(processed)").each(function(){var i=t(this);if(i.find("source").attr("src")==s){let o=e[a].hasOwnProperty("poster")?'<div class="circle_sticker"></div>':"",n=e[a].hasOwnProperty("poster")?'<div class="post_audioart"><img src="'+e[a].poster[0].url+'" alt=""/></div>':"",d=e[a].hasOwnProperty("title")?'<span class="audiotrackname">'+e[a].title+"</span>":"",l=e[a].hasOwnProperty("artist")?'<span class="audioartist">'+e[a].artist+"</span>":"";i.html(n+'<div class="audioinfo">'+d+l+'</div><div class="audiobar"><div class="audioscrubber"></div></div><div class="audiocontrols"><div class="audioicon"><i class="ph ph-rewind-fill"></i></div><div class="audiobutton paused"><i class="ph ph-play-fill"></i><i class="ph ph-pause-fill"></i><span class="sr-only">Play/pause song</span></div><div class="audioicon"><i class="ph ph-fast-forward-fill"></i></div></div>').after(o),x(i,s),i.addClass("processed")}})}}function x(i,e){var a=i.find(".audiobutton"),s=i.find(".audiobar"),o=i.find(".audioscrubber"),n=new Audio(e);n.addEventListener("canplay",function(){i.addClass("playable")}),n.addEventListener("timeupdate",function(){var t=n.duration,i=n.currentTime;i==t&&a.removeClass("playing").addClass("paused"),o.css("width",100*(i/t)+"%")}),a.click(function(){!1==n.paused?(a.removeClass("playing").addClass("paused"),n.pause()):(a.removeClass("paused").addClass("playing"),n.play())}),s.click(function(i){var e=t(this).width(),a=(i.pageX-t(this).offset().left)/e;n.currentTime=a*n.duration,o.css("width",100*a+"%")})}t.fn.photoset=function(){return this.find(".photo-slideshow:not(.processed)").pxuPhotoset({lightbox:!0,highRes:!0,rounded:!1,exif:!1,captions:!1,gutter:s,photoset:".photo-slideshow",photoWrap:".photo-data",photo:".pxu-photo"})},t.fn.video=function(){return this.find(".tmblr-embed:not(.processed)").each(function(){let i=t(this);if(i.find(".instagram-media").exists())i.addClass("processed");else{let e=i.find("iframe").width(),a=i.find("iframe").height();i.find("iframe").wrap('<div class="vid-resize"/>'),i.find(".vid-resize").css({"padding-Bottom":Math.floor(a/e*100)+"%"}),i.addClass("processed")}})},t.fn.npfChat=function(){return this.find(".npf_chat").each(function(){var i=t(this);i.prepend("<br>").append("<br>"),i.find("br").each(function(i){t(this).attr("class",i)});let e=i.children("br").length;for(let a=1;a<e;a++){var s=a-1,o=a,n=i.contents(),d=n.index(i.find('br[class="'+s+'"]')),l=n.index(i.find('br[class="'+o+'"]'));n.slice(d,l).wrapAll("<li>"),a==e-1&&(i.find("br").remove(),i.html('<ul class="post_chat resetlist">'+i.html()+"</ul>").contents().unwrap())}})},t(document).ready(function(){t("#preload, #spinner").addClass("fadeout"),setTimeout(function(){n.removeClass("preinitialize")},1400)}),g(),t.tooltipster.group("tooltip"),n.on("mouseover","#sidebar, .notes",g),h.click(function(t){return t.preventDefault(),n.hasClass("menu--opened")?(n.removeClass("menu--opened"),setTimeout(function(){l.css("display","none")},500)):l.show(0,function(){n.addClass("menu--opened"),k.masonry("layout")}),!1}),c.each(function(){let i=new Date;t(this).find(".day").text((10>i.getDate()?"0":"")+i.getDate()),t(this).find(".month").text(i.toLocaleString("en-us",{month:"short"}))});var k=t(".sidebar_content").masonry({itemSelector:".sidebar-item",columnWidth:1,fitWidth:!0});y(300);var P=_.debounce(function(){b=t(this).scrollTop(),y(0)},300);o.resize(P),o.scroll(function(){b=t(this).scrollTop(),$()}),t(".post:not(.loaded), .thumbnail:not(.loaded)").each(function(){var i,e=t(this);if(e.find(".npf-obj").exists()){var a=e.find(".npf-obj");a.find(".thumbody-text").exists()&&(a.find(".thumbody-text").appendTo(a.parent(".thumbnail_inner")),a.find(".thumbnail_overlay").appendTo(a.parent(".thumbnail_inner"))),a.find(".post_permalink").exists()&&(a.find(".reblog_trail_item").appendTo(a.parent(".post")),a.find(".post_permalink").appendTo(a.parent(".post")),a.find(".notes").appendTo(a.parent(".post")));var s=a.html().replace("!--","").replace("</div-->","");a.html(s);var o=JSON.parse(a.text());console.log(o),e.hasClass("thumbnail")&&("text"==e.attr("data-item-type")||"audio-embed"==e.attr("data-item-type"))&&function t(i,e){var a=e.content,s=e.trail;if(a.length>0){var o=a[0];w(i,o)}else if(0===a.length&&s.length>0&&s[0].content.length>0){var o=s[0].content[0];w(i,o)}}(e,o)}e.photoset(),e.video(),e.npfChat(),(i=e).find("figure").each(function(){var i=t(this);i.find("audio").exists()?i.addClass("npf-tmblr-audio").wrapInner('<div class="post_audio_block"></div>'):i.hasClass("tmblr-embed")||(void 0==i.attr("class")&&void 0!=i.attr("data-orig-width")||void 0!=i.attr("data-tumblr-attribution")?i.wrap('<div class="npf-photo-single"/>'):"tmblr-full"!=i.attr("class")||i.parents(".npf_row").exists()||void 0!=i.attr("data-tumblr-attribution")||i.addClass("npf-photo-item"))}),i.find(".npf_row").each(function(){t(this).addClass("npf-photo-item")}),i.find(".npf-photo-item").not(".npf-photo-item + .npf-photo-item").each(function(){t(this).nextUntil(":not(.npf-photo-item)").addBack().wrapAll('<div class="npf-photo-group"/>')}),i.find('[class*="npf-photo-"] img:not(.post_media_photo)').each(function(){var i=t(this),e=i.attr("src"),a=i.attr("data-orig-height"),s=i.attr("data-orig-width");i.wrap('<a class="post_media_photo_anchor" data-big-photo="'+e+'" data-big-photo-height="'+a+'" data-big-photo-width="'+s+'"/>')}),function i(e,a){if(e.find(".post_audio_block.native:not(.processed)").exists()&&e.find(".post_audio_block.native:not(.processed)").each(function(){var i=t(this),e=i.find(".tumblr_audio_player");let a=e.attr("src"),s=a.split("audio_file=")[1].split(".mp3")[0],o=s.replace(/%3A/g,":").replace(/%2F/g,"/")+".mp3";x(i,o),i.addClass("processed")}),e.find(".npf-tmblr-audio").exists()){var s=a.content,o=a.trail;if(s.length>0)for(let n=0;n<s.length;n++)C(e,s,n);if(o.length>0)for(let d=0;d<o.length;d++){var l=o[d].content;for(let r=0;r<l.length;r++)C(e,l,r)}}}(e,o),e.addClass("loaded")}),t("small").each(function(){let i=t(this).prop("nodeName");t(this).children(i).exists()&&(t(this).addClass("onode"),t(this).children(i).addClass("inode"),t("small.inode").contents().unwrap(),t("small.onode").contents().unwrap())}),t("b, i").each(function(){t(this).closest("#mobile_header").length||t(this).closest("#sidebar").length||t(this).closest('[class*="thumbody-"]').length||t(this).closest(".reblog_trail_item").length||t(this).contents().unwrap()})}(jQuery);
