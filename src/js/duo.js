/*
 * DUO THEME by https://yeoli-thm.tumblr.com/
 * Copyright (c) 2023 yeoli-thm
 */

!function(t){t.fn.exists=function(){return this.length>0};var e=window.getComputedStyle(document.body),a=e.getPropertyValue("--photosetGutterSize"),i={background:"rgba(0,0,0,0)",color:"rgb("+e.getPropertyValue("--audioPostTextColor")+")"},s=t(window),n=t("body");let o=n.hasClass("index-page");n.hasClass("permalink-page");let l=n.hasClass("modeswitch");var d=n.find("a.mode_toggle_button"),r=n.find("a.updates_toggle_button"),p=n.find("#updates"),u=n.find("a#menu-button"),c=n.find("#m-shadow"),h=n.find("#menu"),f=h.find("a.home"),m=h.find("#navigation a.exp"),v=t("#main"),g=["Month",0],$=0,b=0;let C=n.hasClass("plta"),w=n.hasClass("pltb"),_=n.hasClass("pltc");var k=n.find(".load_more_button");if(w)var y=null,x=400,S=!0;else if(_)var y=".load_more_button",x=!1,S=!1;var L=n.find("#to-top"),N={width:14,height:14,"stroke-width":2};function T(){t("[title]").tooltipster({anchor:"top-left",offset:[14,-18],plugins:["follower"],animationDuration:300,delay:100,maxWidth:160,updateAnimation:null,trigger:"custom",triggerOpen:{click:!0,mouseenter:!0,tap:!1,touchstart:!1},triggerClose:{click:!1,mouseleave:!0,originClick:!1,scroll:!0,tap:!0,touchleave:!0}})}function A(){T(),t.tooltipster.group("tooltip"),n.on("mouseover","#sidebar, #updates, .notes",T)}function D(){t(".posts:not(.appended)").each(function(){let e=t(this);if(void 0!==e.attr("id")){var a,s;e.attr("id");let n=[e.attr("data-month"),e.attr("data-day")];g[0]!==n[0]?($++,b=1,e.wrap('<div class="month-group-'+$+'"><div class="day-group-'+$+"-"+b+'"></div></div>'),t('<div class="month_label"><span>'+n[0]+"</span></div>").prependTo(v.find(".month-group-"+$)),t('<div class="day_label">'+n[1]+"</div>").prependTo(v.find(".day-group-"+$+"-"+b)),g.splice(0,2,n[0],n[1])):g[1]==n[1]?e.appendTo(v.find(".day-group-"+$+"-"+b)):g[1]!==n[1]&&(b++,e.appendTo(v.find(".month-group-"+$)).wrap('<div class="day-group-'+$+"-"+b+'"></div>'),t('<div class="day_label">'+n[1]+"</div>").prependTo(v.find(".day-group-"+$+"-"+b)),g.splice(1,1,n[1])),e.photoset(),e.video(),(a=e).find("iframe.tumblr_audio_player").load(function(){var e=t(this);e.contents().find(".audio-player").css(i).find(".progress").css({background:"rgba(0,0,0,0)"}),e.css({opacity:"1"})}),a.find(".audio-caption:not(.processed)").each(function(){var e=t(this),a=e.next("audio").children("source").attr("src"),i="",s="",n=e.find(".tmblr-audio-meta.title").exists()?'<p class="trackname">'+e.find(".tmblr-audio-meta.title").text()+"</p>":"",o=e.find(".tmblr-audio-meta.artist").exists()?'<p class="artist">'+e.find(".tmblr-audio-meta.artist").text()+"</p>":"";e.find("img.album-cover").exists()&&(s='<div class="album_art"><img src="'+(i=e.find("img.album-cover").attr("src"))+'" alt=""/></div>',e.attr("style","background-image:url("+i+")")),e.html('<div class="audio_inner"><div class="player_container"><div class="svgaudiobutton"><svg class="playbutton"><use xlink:href="#playButton"/></svg><svg class="pausebutton"><use xlink:href="#pauseButton"/></svg></div></div><div class="audio_details">'+n+o+"</div>"+s+"</div>");var l=e.find(".svgaudiobutton"),d=new Audio(a);d.addEventListener("canplay",function(){l.addClass("playable")}),d.addEventListener("timeupdate",function(){var t=d.duration;d.currentTime==t&&l.removeClass("playing").addClass("paused")}),l.click(function(){!1==d.paused?(l.removeClass("playing").addClass("paused"),d.pause()):(l.removeClass("paused").addClass("playing"),d.play())}),e.addClass("processed")}),(s=e).find("figure").each(function(){t(this).find(".audio-caption").exists()||(void 0==t(this).attr("class")&&void 0!=t(this).attr("data-orig-width")||void 0!=t(this).attr("data-tumblr-attribution")?t(this).wrap('<div class="npf-wrap-single"/>'):"tmblr-full"!=t(this).attr("class")||t(this).parents(".npf_row").exists()||void 0!=t(this).attr("data-tumblr-attribution")||t(this).addClass("npf-item"))}),s.find(".npf_row").each(function(){t(this).addClass("npf-item")}),s.find(".npf-item").not(".npf-item + .npf-item").each(function(){t(this).nextUntil(":not(.npf-item)").addBack().wrapAll('<div class="npf-wrap-all"/>')}),e.npfQuote(),e.npfChat(),e.npfLink()}return e.addClass("appended"),this})}if(t.fn.photoset=function(){return this.find(".photo-slideshow:not(.processed)").pxuPhotoset({lightbox:!0,highRes:!0,rounded:!1,exif:!1,captions:!1,gutter:a,photoset:".photo-slideshow",photoWrap:".photo-data",photo:".pxu-photo"})},t.fn.video=function(){return this.find(".tmblr-embed:not(.processed)").each(function(){let e=t(this);if(e.find(".instagram-media").exists())e.addClass("processed");else{let a=e.find("iframe").width(),i=e.find("iframe").height();e.find("iframe").wrap('<div class="vid-resize"/>'),e.find(".vid-resize").css({"padding-Bottom":Math.floor(i/a*100)+"%"}),e.addClass("processed")}})},t.fn.npfQuote=function(){return this.find(".npf_quote").each(function(){var e=t(this),a=e.html();e.replaceWith('<div class="quote"><i>'+a+"</i></div>")})},t.fn.npfChat=function(){return this.find(".npf_chat").each(function(){var e=t(this);e.prepend("<br>").append("<br>"),e.find("br").each(function(e){t(this).attr("class",e)});let a=e.children("br").length;for(let i=1;i<a;i++){var s=i-1,n=i,o=e.contents(),l=o.index(e.find('br[class="'+s+'"]')),d=o.index(e.find('br[class="'+n+'"]'));o.slice(l,d).wrapAll("<li>"),i==a-1&&(e.find("br").remove(),e.html('<ul class="chat resetlist">'+e.html()+"</ul>").contents().unwrap())}})},t.fn.npfLink=function(){return this.find(".npf-link-block").each(function(){var e=t(this),a=t(this).find("a").attr("href"),i=t(this).find(".title").exists()?"<h3>"+t(this).find(".title").text()+"</h3>":"";e.replaceWith('<a class="plink" href="'+a+'" target="_blank">'+i+'<i data-feather="chevron-right"></i></div>'),feather.replace(N)})},A(),feather.replace(N),l){localStorage.getItem("modeStatus")?"Light"==localStorage.getItem("modeStatus")?n.addClass("light"):"Dark"==localStorage.getItem("modeStatus")&&(n.addClass("dark"),d.tooltipster("content","Light mode")):(localStorage.setItem("modeStatus","Light"),n.addClass("light"));var B=localStorage.getItem("modeStatus");d.click(function(t){t.preventDefault(),"Light"==B?(n.toggleClass("light dark"),d.tooltipster("content","Light mode"),B="Dark"):(n.toggleClass("dark light"),d.tooltipster("content","Dark mode"),B="Light"),localStorage.modeStatus=B})}n.fadeTo(1200,1),r.click(function(t){t.preventDefault(),n.hasClass("updates--open")?(r.removeClass("on"),n.removeClass("updates--open").each(function(){setTimeout(function(){p.hide(0)},500)})):(r.addClass("on"),p.show(0,function(){n.addClass("updates--open")}))}),u.add(c).click(function(t){t.preventDefault(),n.hasClass("menu--open")?h.removeClass("on").each(function(){setTimeout(function(){h.hide(0),n.removeClass("menu--open")},500)}):(n.addClass("menu--open"),h.show(0,function(){h.addClass("on")}))}),m.each(function(){let e=t(this),a=t(this).next(".sub-nav"),i=t(this).attr("href").slice(1);0==a.children().length&&e.parent("li").remove(),e.click(function(t){t.preventDefault(),e.hasClass("slct")?(f.removeClass(i+"--active"),e.removeClass("slct"),a.slideUp(250)):(f.addClass(i+"--active"),e.addClass("slct"),a.slideDown(250))})}),D(),t(".npf_row").each(function(){t(this).addClass("clickable")}),t("main").each(function(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg"),a=document.createElementNS("http://www.w3.org/2000/svg","symbol"),i=document.createElementNS("http://www.w3.org/2000/svg","symbol"),s=document.createElementNS("http://www.w3.org/2000/svg","path"),n=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttributeNS(null,"d","M3.947,20.834V3.166l16.105,8.833L3.947,20.834L3.947,20.834z"),a.setAttributeNS(null,"id","playButton"),a.setAttributeNS(null,"viewbox","0 0 24 24"),a.appendChild(s),n.setAttributeNS(null,"d","M3.897,3.6h6.569v16.8H3.897V3.6z M13.534,3.6h6.568v16.8h-6.568V3.6z"),i.setAttributeNS(null,"id","pauseButton"),i.setAttributeNS(null,"viewbox","0 0 24 24"),i.appendChild(n),e.setAttributeNS(null,"width","0"),e.setAttributeNS(null,"height","0"),e.appendChild(a),e.appendChild(i),t(this).append(e)}),o&&!C&&(v.infiniteScroll({path:"a#next",append:"#main .posts",status:".page-load-status",button:y,scrollThreshold:x,prefill:S}),v.on("request.infiniteScroll",function(t,e){k.addClass("hide")}),v.on("append.infiniteScroll",function(e,a,i,s){D(),t(".npf_row:not(.clickable):not(.disabled)").each(function(){t(this).addClass("disabled")});var n=t(s).map(function(){return t(this).attr("id")}).get();Tumblr.LikeButton.get_status_by_post_ids(n),A(),feather.replace(N),k.removeClass("hide")})),s.scroll(function(){var e=t(this).scrollTop();e>300&&!L.hasClass("show")?L.addClass("show"):e<=300&&L.hasClass("show")&&L.removeClass("show")}),L.click(function(e){e.preventDefault(),t("html,body").animate({scrollTop:0},400)}),document.querySelector("#credit .year").textContent=new Date().getFullYear(),s.load(function(){let e=0,a=setInterval(function(){e<10&&(t(".iframe-controls--desktop").exists()||t(".iframe-controls--phone-mobile").exists())?(clearInterval(a),t(".tmblr-iframe--loaded").clone().appendTo(h.find("#tumblr-controls-box"))):10===e&&clearInterval(a),e++},1e3)})}(jQuery);
